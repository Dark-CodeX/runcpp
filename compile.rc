if os == 'windows'
    depends('cl.exe') # *.exe is important
else
    depends('clang++')
    depends('mv')
    depends('mkdir')
endif

[compiler]:
    if os == 'windows'
        compiler = 'cl.exe'
    else
        compiler = 'clang++'
    endif

[arguments]:
    if os == 'windows'
        release_args = ['/std:c++latest', '/O2', '/DNDEBUG', '/EHsc']
    else
        release_args = ['-std=c++2a', '-O3', '-DNDEBUG', '-march=native', '-mtune=native', '-masm=intel', '-flto']
        debug_args = ['-std=c++2a', '-g', '-ggdb3', '-Wall', '-Wextra', '-Wuninitialized', '-Wstrict-aliasing', '-Wshadow', '-pedantic']
    endif

[setup]:
    if os != 'windows'
        make_dir = ['mkdir', '-p', './bin']
    endif

import "./runcpp/compile.rc"

# here we are using `all`, which means every command is executed like a separate process
[all]:
    if os != 'windows'
        setup()
    endif
    release()
    if os != 'windows'
        debug()
    endif
    if os != 'windows'
        install()
    endif
